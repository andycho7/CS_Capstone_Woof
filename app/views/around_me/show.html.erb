<!--<%= stylesheet_link_tag '/around_mes.css' %>
<h1>AroundMe for <%="#{@user.first_name} #{@user.last_name}"%></h1>
<% @around_me_events.each do |event|%>
  <% around_me = event.pet_event %>
  <p><%="id #{around_me.id}, longitude #{around_me.longitude}, latitude #{around_me.latitude}"%></p>
<% end %>-->
<!--<head>
  <link rel = "stylesheet" href="style.css">
</head>-->
<!-- <%= javascript_include_tag 'around_mes', 'data-turbolinks-track': 'reload' %>
<%= stylesheet_link_tag    'around_mes', media: 'all', 'data-turbolinks-track': 'reload' %> -->

<h1>Map</h1>
<div id="map-canvas"></div>

<%= form_tag("/around_me/create_lost_dog", method: "post", id: "lost_dog_event", remote: true) do %>
  <%= label_tag(:user_id, "User ID") %>
  <%= text_field_tag(:user_id, @user.id, :readonly => true) %><br>
  <%= label_tag(:pet_id, "Pet ID") %>
  <%= text_field_tag(:pet_id, @pets[0].id, :readonly => true) %><br><!-- You have to changee this to dynamically select the pet-->
  <%= label_tag(:latitude, "Latitude") %>
  <%= text_field_tag (:latitude) %><br>
  <%= label_tag(:longitude, "Longitude") %>
  <%= text_field_tag (:longitude) %><br>
  <%= label_tag(:description, "Description") %>
  <%= text_field_tag (:description) %><br>
  <%= submit_tag("Create Event") %>
<% end %>

  <div id="closeButton">
     <button onclick="closeForm()">Close</button> 
  </div>

<script>

  $("#lost_dog_event").hide();
  $("#closeButton").hide();

  function closeForm()
  {
    $("#lost_dog_event").hide();
    $("#closeButton").hide();
    document.getElementById("lost_dog_event").description.value = " ";
  }

  var mapOption = {
                      center: {lat: 40.7608, lng: -111.8910},
                      zoom: 8
                  }

    var map;

    function initMap() 
    {
      map = new google.maps.Map(document.getElementById('map-canvas'), mapOption);

      /*console.log(gon.user);
      console.log(gon.around_me_events[0]);
      console.log(gon.pets[0]);
      console.log(gon.pets[1]);*/

      for(var i = 0; i < gon.around_me_events.length; i++)
      {
        var latitude = gon.around_me_events[i].latitude;
        var longitude = gon.around_me_events[i].longitude;

        var co_ordinates = {lat: parseFloat(latitude),
                    lng: parseFloat(longitude)};

        var marker = new google.maps.Marker({
          position: co_ordinates,
          map: map
        });
      }

      google.maps.event.addListener(map, 'click', function(event){

        // On click over here -> use the latitude and longtitude values below
        // use the user id and pet id from the previous page
        // Take the description from the user

        var latitude = event.latLng.lat();
        var longitude = event.latLng.lng();
        //console.log("Latitude is : "  + latitude);
        //console.log("Longitude is : "  + longitude);
        $("#lost_dog_event").show();
        $("#closeButton").show();

        document.getElementById("lost_dog_event").latitude.value = latitude;
        document.getElementById("lost_dog_event").longitude.value = longitude;
      });
    }
      
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBGAMfpUVwJJYpahbklrZ0Q_RPU0NgpuP4&callback=initMap" async defer></script>