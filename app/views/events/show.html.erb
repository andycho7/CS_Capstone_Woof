<h1>User: <%= @user.first_name  + " " + @user.last_name %></h1>
<div id="map" class = "abs-center-x"></div>

<% @pet_name_id = Array.new %>
<% @pets.each do |pet| %>
  <% @pet_info = Array.new %>
  <% @pet_info.push(pet.id) %>  
  <% @pet_info.push(pet.name) %>
  <% @pet_name_id.push(@pet_info) %>
<% end %>
<script>

  //closeForm();

  var map;
  var event_window = null;
  var infoWindow = null;

  /*function closeForm()
  {
    $("#lost_dog_event").hide();
    $("#closeButton").hide();
    document.getElementById("lost_dog_event").description.value = " ";
  }*/

  var mapOption = {
                      center: {lat: 40.7608, lng: -111.8910},
                      zoom: 8
                  }

    function initMap() 
    {
      map = new google.maps.Map(document.getElementById('map'), mapOption);

      for(var i = 0; i < gon.around_me_events.length; i++)
      {
        var latitude = gon.around_me_events[i].latitude;
        var longitude = gon.around_me_events[i].longitude;

        var co_ordinates = {lat: parseFloat(latitude),
                    lng: parseFloat(longitude)};

        var marker = new google.maps.Marker({
          position: co_ordinates,
          map: map,
        });

        var marker_description = "";
        debugger;
        marker_description+= "<p><b>Event Type:</b> "+gon.event_types[i]+"</p>";
        marker_description+= "<p><b>Description:</b>"+gon.descriptions[i]+"</p>";

        infoWindow = new google.maps.InfoWindow();

        google.maps.event.addListener(marker, 'click', (function(marker, marker_description, infoWindow){
          return function()
          {
            // infoWindow.setContent(this.html);
            infoWindow.setContent(marker_description);
            infoWindow.open(map, marker);
          };
        })(marker, marker_description, infoWindow));
      }
      activateClick();
    }

    function activateClick()
    {
       google.maps.event.addListener(map, 'click', function(event){

        // Take the description from the user

        var latitude = event.latLng.lat();
        var longitude = event.latLng.lng();
        //$("#lost_dog_event2").show();
        //$("#closeButton").show();

       // document.getElementById("lost_dog_event2").latitude.value = latitude;
        //document.getElementById("lost_dog_event2").longitude.value = longitude;

        var event_coordinates = {lat: latitude, lng: longitude}

        if(event_window != null)
        {
          event_window.close();
        }

        event_window = new google.maps.InfoWindow({
          position: event_coordinates,
        });

        var event_form = "";

        // '<%= select_tag(:pet_id, options_for_select('+ #{@pet_name_id} + ')) %><br>'+
        // '<%= text_field_tag(:pet_id, @pets[0].id , :readonly => true) %><br>'+
        // '<%= select_tag(:pet_id, options_for_select("#{@pet_name_id}")) %><br>'+

        event_form = '<%= form_tag("/events/create_lost_dog", method: "post", id: "lost_dog_event", remote: true) do %>' +
                        '<%= hidden_field_tag(:user_id, @user.id) %>' +
                        '<%= label_tag(:user_name, "User") %><br>' +
                        '<%= text_field_tag(:user_name, @user.first_name + " " + @user.last_name , :readonly => true) %><br>' +
                        '<%= hidden_field_tag(:pet_id, @pets[0].id ) %>'+
                        '<%= label_tag(:pet_name, "Pet") %>'+
                        '<%= text_field_tag(:pet_name, @pets[0].name , :readonly => true) %><br>'+
                        '<%= label_tag(:latitude, "Latitude") %>' +
                        '<%= text_field_tag (:latitude) %><br>' +
                        '<%= label_tag(:longitude, "Longitude") %>' +
                        '<%= text_field_tag (:longitude) %><br>' +
                        '<%= label_tag(:description, "Description") %>' +
                        '<%= text_field_tag (:description) %><br>' +
                        '<%= submit_tag("Create Event") %>' +
                      '<% end %>';

        event_window.setContent(event_form);
        event_window.open(map);

        document.getElementById("lost_dog_event").latitude.value = latitude;
        document.getElementById("lost_dog_event").longitude.value = longitude;
      });
    }
      
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBGAMfpUVwJJYpahbklrZ0Q_RPU0NgpuP4&callback=initMap" async defer></script>